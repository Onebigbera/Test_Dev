## Python内存管理

[toc]

### 一、对象引用

在Python中我们来看一个最简单的赋值语句：

~~~python
a = 10
~~~

首先这个10它是一个数值类型的对象，那么这个a呢？它只是一个对10这个对象引用的变量，如果我们再进行赋值语句

~~~python
b = a
~~~

我们此时打印b，返回的结果也是10这个对象，b也是对10这个常量的引用。

- **变量**，通过变量指针引用对象

     变量指针指向具体的对象的存储空间，取对象的值。

- **对象**，类型已知，每个对象都包含一个头部信息（头部信息：类型标识符和引用计数器）

~~~python
a =  10 # 此时变量a指向10这个对象，在10这个对象中（头部中包含的信息为对象类型为int,指向这个变量的计数器为1

b = a   # 此时变量b引用变量a,因为变量a引用的是常量10，那么此时b引用的就是10这个对象（那么此时10这个对象的引用计数器就为2）
~~~

![](..\Images\variable.png)

我们要查看两个变量是不是引用的同一个对象，可以有两种方法：

1. 通过查看变量的id(指向变量的内存地址)，查看结果是否一致
2. 通过is判断是否为同一个对象

~~~python
a = 100
b = 100

print(id(a))
print(id(b))
print(a is b) # True
~~~

##### 1.引用计数

##### 2.内置函数is和id

##### 3.数据的可变性

### 二、小整数池和intern机制

小整数池的范围为 -5 ~256，其针对值为数值；

大整数池为针对字符串，只存储包含标准字符串（数字、字母 、下划线），如果有空格、特殊字符等就不会一样,包含特殊字符的字符串不会被添加到大整数池里面。

~~~python
a = 'aaa'
b = 'aaa'
print(a is b) #True

a = 'aa a'
b = 'aa a'
print(a is b) # False 因为包含了非标准字符空格
~~~



### 三、深浅拷贝 

**深浅拷贝   深拷贝是值拷贝，浅拷贝是引用拷贝**

深浅拷贝一般只在讨论嵌套列表时讨论

![](..\Images\copy_deepcopy.png)

~~~
from copy import copy, deepcopy
from _pickle import loads, dumps


a = [1, 2, 3]
b = [a] * 3

# 拷贝
c = copy(b)

# 深拷贝
d = deepcopy(b)

# 咸菜帮
e = loads(dumps(b, 4))

b[1].append(999)
c[1].append(999)
d[1].append(999)
e[1].append(999)

print(b)
print(c)
print(d)
print(e)
~~~



#### 四、垃圾回收和GC模块

python的垃圾回收机制用一句话来描述就是：引用计数为主，标记-清除和分代收集两种机制为辅的策略。详细查看之前做过的笔记。

